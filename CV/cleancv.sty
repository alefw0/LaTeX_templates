% Estilo 

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{cleancv}[2025/04/10 Clean Academic CV Style]


% Paquetes esenciales 

\RequirePackage[T1]{fontenc}                % Codificación de fuente
\RequirePackage{fontawesome}                % Iconos para información de contacto
\RequirePackage[oldstyle,proportional]{ETbb}% Fuente ET Book elegante
\RequirePackage{geometry}                   % Márgenes y layout
\RequirePackage{sectsty}                    % Formato de secciones
\RequirePackage{hyperref}                   % Enlaces e hipervínculos
\RequirePackage[dvipsnames]{xcolor}         % Colores personalizados
\RequirePackage{enumitem}                   % Listas personalizadas
\RequirePackage{titlesec}                   % Formato de títulos
\RequirePackage{fancyhdr}                   % Encabezados y pies
\RequirePackage{etoolbox}                   % Comandos condicionales

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Configuración de márgenes y geometría
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\geometry{
  letterpaper,
  left=2.5cm,
  right=2.5cm,
  top=2cm,
  bottom=2.5cm
}

% Tipografía limpia y espaciado
\setlength{\parindent}{0pt}
\setlength{\parskip}{0.2em}
\titlespacing*{\section}{0pt}{1.5em}{0.5em}
\titlespacing*{\subsection}{0pt}{0.8em}{0.2em}

% Encabezado y pie de página
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
%\fancyfoot[L]{\footnotesize Página \thepage}
%\fancyfoot[R]{\footnotesize Actualizado: \today}


%%% Tipografía y estilos %%%

% Encabezados con pequeñas mayúsculas
\titleformat{\section}{\Large\normalfont\scshape\bfseries}{\thesection}{1em}{}
\allsectionsfont{\mdseries\scshape}

% Evitar viudas y huérfanas tipográficas
\clubpenalty=10000
\widowpenalty=10000
\displaywidowpenalty=10000

% Color principal (púrpura por defecto)
\definecolor{primary}{RGB}{83, 39, 115}

% Configuración de hipervínculos
\hypersetup{
  colorlinks=true,
  urlcolor=primary,
  linkcolor=primary,
  citecolor=primary,
  pdftitle={Curriculum Vitae},
  pdfauthor={},
  pdfcreator={},
  pdfproducer={}
}


%%% Comandos para encabezado %%%


% Nombre en la parte superior del CV
\newcommand{\cvname}[1]{
  \begin{center}
    {\Huge \textsc{#1}}
  \end{center}
}

% Barra de contacto con email, GitHub y ubicación
% Argumentos: email, usuario GitHub, ubicación
\newcommand{\contactbar}[3]{
  \begin{center}
    \small
    \faEnvelope\space{\href{mailto:#1}{#1}} \enspace
    \faGithub\space{\href{https://github.com/#2}{#2}} \enspace
    \faMapMarker\space{#3} \enspace
  \end{center}
}


%%% Modo CV/Resume %%%

\newif\ifcv
\cvtrue  % Modo CV: todas las secciones
% \cvfalse % Modo resume: secciones limitadas


%%% Comandos para formatear contenido %%%

% Bloque de entrada con detalles (experiencia, educación, proyectos)
% Argumentos: [items opcional], institución, ubicación, título/grado, fecha
\newcommand{\cvblock}[5][]{
  \textbf{#2} \hfill #3 \\ #4 \hfill #5 \par
  \ifx&#1&\else\begin{itemize}#1\end{itemize}\fi
}

% Entrada simple de una línea (premios, honores, habilidades)
% Argumentos: nombre/logro, institución/contexto, fecha
\newcommand{\cvitem}[3]{
  \item #1, \emph{#2} \dotfill #3
}

% Formato compacto y limpio para listas
\setlist[itemize]{nosep, left=0pt}


%%% Gestión de bibliografía %%%

\RequirePackage[style=numeric, sorting=ydnt, backend=biber]{biblatex}

% Pone el nombre del autor en negrita en la bibliografía
% Uso: \boldname{Apellido}{Nombre}{Inicial}
\newcommand*{\boldname}[3]{%
  \def\lastname{#1}%
  \def\firstname{#2}%
  \def\firstinit{#3}}
\boldname{}{}{}

% Implementación del resaltado de nombre en bibliografía
\renewcommand{\mkbibnamegiven}[1]{%
  \ifboolexpr{ ( test {\ifdefequal{\firstname}{\namepartgiven}} or test {\ifdefequal{\firstinit}{\namepartgiven}} ) and test {\ifdefequal{\lastname}{\namepartfamily}} }
  {\mkbibbold{#1}}{#1}%
}
\renewcommand{\mkbibnamefamily}[1]{%
  \ifboolexpr{ ( test {\ifdefequal{\firstname}{\namepartgiven}} or test {\ifdefequal{\firstinit}{\namepartgiven}} ) and test {\ifdefequal{\lastname}{\namepartfamily}} }
  {\mkbibbold{#1}}{#1}%
  % Anotaciones de autor (superíndices) %opcional
  %\ifitemannotation{equal}{\textsuperscript{*}}{}% Contribución igualitaria
  %\ifitemannotation{corresponding}{$^\dagger$}{}% Autor correspondiente
}